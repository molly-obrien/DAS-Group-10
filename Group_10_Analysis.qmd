---
title: "Group_10_Analysis"
format: 
 html: 
  embed-resources: true
editor: visual
execute: 
 echo: false
 eval: true
 warning: false
 error: false
 message: false
---

# Formative Data Analysis

```{r}
setwd("C:\\Users\\Theo\\OneDrive - University of Glasgow\\Desktop\\DA Group data")
dataset <- read.csv("DAProject16.csv")
library(tidymodels)
library(parsnip)
library(magrittr)
library(dplyr)
library(ggplot2)

dataset <- dataset |> mutate(proportions = Y/N)
dataset$Post2004 <- ifelse(dataset$Year >= 2004, 1, 0)

```

Examining our first question of interest: "Did Glasgow exhibit a change in measles susceptibility following the retraction of the Wakefield article?"

We must model our data to include an indicator variable examining the difference between the number of people susceptible to measles before and after the article retraction.

It's appropriate to model this data under a binomial assumption as long as we specify our successes/ failures appropriately:

We fit the GLM:

$$
g(p_i) = logit(p_i) = \alpha + \beta_{year} \cdot year + \beta_{post2004} \cdot \mathbb{I}_{post2004} + \beta_{year,post2004} \cdot year \cdot \mathbb{I}_{post2004}
$$

So that,

$$
g(p_i) = logit(p_i) = \begin{cases} 
\alpha + \beta_{year} \cdot year {\text{,  for years before 2004}} \\
\alpha + \beta_{year} \cdot year + \beta_{post2004} + \beta_{year,post2004} \cdot year {\text{,  otherwise}}
\end{cases}
$$

This is where:

-   $\alpha$ is our model intercept.

-   $\beta_{year}$ is our model coefficient for 'Year' (in terms of an increase/decrease in log-odds).

-   $\beta_{post2004}$ is our beta coefficient for the log-odds of susceptibility for years after 2004 compared to before.

-   $\mathbb{I}_{post2004}$ is our indicator function where:

$$
\mathbb{I}_{post2004} = \begin{cases}
1 ~ \text{if the observation is taken post-2004} \\
0 ~ \text{otherwise}
\end{cases}
$$

-   $\beta_{year,post2004}$ is our interaction term between our explanatory variables.

Here's a visualisation of our model:

```{r}

dataset$successes <- dataset$N - dataset$Y  

model_bin <- glm(cbind(Y, successes) ~ Year + Post2004 + Year:Post2004, 
             family = binomial, data = dataset)

summary(model_bin)
```

However, we must be careful to avoid modelling with overdispersion. The overdispersion ratio - \$ \\hat{\\phi} = \\frac{\\text{residual deviance}}{\\text{df}\_{\\text{residual deviance}}} \$ - gives us information on the overdispersion.

```{r}
overdispersion_ratio <- summary(model_bin)$deviance / summary(model_bin)$df.residual
print(overdispersion_ratio)
```

This value is far greater than 1. This suggests that we have heavy overdispersion and we should adjust our model.

```{r}
model_quasi <- glm(cbind(Y, successes) ~ Year * Post2004, 
                   family = quasibinomial, data = dataset)
summary(model_quasi)
```

Displayed above is our quasi-binomial model. The standard errors have changed to so that our intervals for significance are adjusted for overdispersion.
